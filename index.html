<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <title>Check you daily habits behind the curtains</title>
      <link rel="stylesheet" href="css/base.css">
      <script src="js/theme-registry.js"></script>
      <script src="js/theme-engine.js"></script>
      <style>
         /* Theme-specific visibility rules - dynamically managed by theme engine */
         .starry-night .sun, .starry-night .bubble-icon, .starry-night .leaf-icon, .starry-night .petal-icon, .starry-night .snowflake-icon, .starry-night .raindrop-icon { display: none; }
         .starry-night .moon { display: block; }
         .starry-night .clouds, .starry-night .waves, .starry-night .leaves, .starry-night .petals, .starry-night .snowflakes, .starry-night .raindrops { display: none; }
         .starry-night .stars { display: block; }
         
         .cloudy-day .moon, .cloudy-day .bubble-icon, .cloudy-day .leaf-icon, .cloudy-day .petal-icon, .cloudy-day .snowflake-icon, .cloudy-day .raindrop-icon { display: none; }
         .cloudy-day .sun { display: block; }
         .cloudy-day .stars, .cloudy-day .waves, .cloudy-day .leaves, .cloudy-day .petals, .cloudy-day .snowflakes, .cloudy-day .raindrops { display: none; }
         .cloudy-day .clouds { display: block; }
         
         .ocean .sun, .ocean .moon, .ocean .leaf-icon, .ocean .petal-icon, .ocean .snowflake-icon, .ocean .raindrop-icon { display: none; }
         .ocean .bubble-icon { display: block; }
         .ocean .stars, .ocean .clouds, .ocean .leaves, .ocean .petals, .ocean .snowflakes, .ocean .raindrops { display: none; }
         .ocean .waves { display: block; }
         
         .forest .sun, .forest .moon, .forest .bubble-icon, .forest .petal-icon, .forest .snowflake-icon, .forest .raindrop-icon { display: none; }
         .forest .leaf-icon { display: block; }
         .forest .stars, .forest .clouds, .forest .waves, .forest .petals, .forest .snowflakes, .forest .raindrops { display: none; }
         .forest .leaves { display: block; }
         
         .cherry-blossom .sun, .cherry-blossom .moon, .cherry-blossom .bubble-icon, .cherry-blossom .leaf-icon, .cherry-blossom .snowflake-icon, .cherry-blossom .raindrop-icon { display: none; }
         .cherry-blossom .petal-icon { display: block; }
         .cherry-blossom .stars, .cherry-blossom .clouds, .cherry-blossom .waves, .cherry-blossom .leaves, .cherry-blossom .snowflakes, .cherry-blossom .raindrops { display: none; }
         .cherry-blossom .petals { display: block; }
         
         .snow .sun, .snow .moon, .snow .bubble-icon, .snow .leaf-icon, .snow .petal-icon, .snow .raindrop-icon { display: none; }
         .snow .snowflake-icon { display: block; }
         .snow .stars, .snow .clouds, .snow .waves, .snow .leaves, .snow .petals, .snow .raindrops { display: none; }
         .snow .snowflakes { display: block; }
         
         .rain .sun, .rain .moon, .rain .bubble-icon, .rain .leaf-icon, .rain .petal-icon, .rain .snowflake-icon { display: none; }
         .rain .raindrop-icon { display: block; }
         .rain .stars, .rain .clouds, .rain .waves, .rain .leaves, .rain .petals, .rain .snowflakes { display: none; }
         .rain .raindrops { display: block; }
      </style>
   </head>
   <body class="starry-night">
      <!-- Background Elements -->
      <div class="stars" id="stars"></div>
      <div class="clouds" id="clouds"></div>
      <div class="waves" id="waves"></div>
      <div class="leaves" id="leaves"></div>
      <div class="petals" id="petals"></div>
      <div class="snowflakes" id="snowflakes"></div>
      <div class="raindrops" id="raindrops"></div>
      
      <!-- Completion Animation -->
      <div class="completion-overlay" id="completion-overlay">
         <div class="completion-content">
            <div class="completion-icon">ðŸŽ‰</div>
            <h2>Amazing Work!</h2>
            <p>You've completed all your habits for today!</p>
         </div>
         <div class="confetti" id="confetti"></div>
      </div>
      
      <!-- Mobile Header (shown only on mobile) -->
      <div class="mobile-header">
         <div class="mobile-header-left">
            <div class="date-info" id="current-date-mobile"></div>
         </div>
         <div class="mobile-header-center">
            <div class="streak-counter" id="streak-counter-mobile">ðŸŒ± Start your streak!</div>
         </div>
         <div class="mobile-header-right">
            <div class="theme-dropdown" id="theme-dropdown-mobile">
               <button class="theme-dropdown-toggle" onclick="toggleThemeDropdown()" id="theme-dropdown-toggle-mobile">
                  <div class="current-theme-icon">
                     <div class="sun"></div>
                     <div class="moon"></div>
                     <div class="bubble-icon"></div>
                     <div class="leaf-icon"></div>
                     <div class="petal-icon"></div>
                     <div class="snowflake-icon"></div>
                     <div class="raindrop-icon"></div>
                  </div>
                  <span class="dropdown-arrow">â–¼</span>
               </button>
               <div class="theme-dropdown-menu" id="theme-dropdown-menu-mobile">
                  <div class="theme-dropdown-option" data-theme="starry-night">
                     <div class="theme-preview starry-night-preview"></div>
                     <span class="theme-name">Starry Night</span>
                  </div>
                  <div class="theme-dropdown-option" data-theme="cloudy-day">
                     <div class="theme-preview cloudy-day-preview"></div>
                     <span class="theme-name">Cloudy Day</span>
                  </div>
                  <div class="theme-dropdown-option" data-theme="ocean">
                     <div class="theme-preview ocean-preview"></div>
                     <span class="theme-name">Ocean</span>
                  </div>
                  <div class="theme-dropdown-option" data-theme="forest">
                     <div class="theme-preview forest-preview"></div>
                     <span class="theme-name">Forest</span>
                  </div>
                  <div class="theme-dropdown-option" data-theme="cherry-blossom">
                     <div class="theme-preview cherry-blossom-preview"></div>
                     <span class="theme-name">Cherry</span>
                  </div>
                  <div class="theme-dropdown-option" data-theme="snow">
                     <div class="theme-preview snow-preview"></div>
                     <span class="theme-name">Snow</span>
                  </div>
                  <div class="theme-dropdown-option" data-theme="rain">
                     <div class="theme-preview rain-preview"></div>
                     <span class="theme-name">Rain</span>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <!-- Desktop Header (hidden on mobile) -->
      <div class="top-left-info">
         <div class="date-info" id="current-date"></div>
      </div>
      
      <div class="top-right-info">
         <div class="streak-counter" id="streak-counter">ðŸŒ± Start your streak!</div>
         <div class="theme-dropdown" id="theme-dropdown">
            <button class="theme-dropdown-toggle" onclick="toggleThemeDropdown()" id="theme-dropdown-toggle">
               <div class="current-theme-icon">
                  <div class="sun"></div>
                  <div class="moon"></div>
                  <div class="bubble-icon"></div>
                  <div class="leaf-icon"></div>
                  <div class="petal-icon"></div>
                  <div class="snowflake-icon"></div>
                  <div class="raindrop-icon"></div>
               </div>
               <span class="dropdown-arrow">â–¼</span>
            </button>
            <div class="theme-dropdown-menu" id="theme-dropdown-menu">
               <div class="theme-dropdown-option" data-theme="starry-night">
                  <div class="theme-preview starry-night-preview"></div>
                  <span class="theme-name">Starry Night</span>
               </div>
               <div class="theme-dropdown-option" data-theme="cloudy-day">
                  <div class="theme-preview cloudy-day-preview"></div>
                  <span class="theme-name">Cloudy Day</span>
               </div>
               <div class="theme-dropdown-option" data-theme="ocean">
                  <div class="theme-preview ocean-preview"></div>
                  <span class="theme-name">Ocean</span>
               </div>
               <div class="theme-dropdown-option" data-theme="forest">
                  <div class="theme-preview forest-preview"></div>
                  <span class="theme-name">Forest</span>
               </div>
               <div class="theme-dropdown-option" data-theme="cherry-blossom">
                  <div class="theme-preview cherry-blossom-preview"></div>
                  <span class="theme-name">Cherry</span>
               </div>
               <div class="theme-dropdown-option" data-theme="snow">
                  <div class="theme-preview snow-preview"></div>
                  <span class="theme-name">Snow</span>
               </div>
               <div class="theme-dropdown-option" data-theme="rain">
                  <div class="theme-preview rain-preview"></div>
                  <span class="theme-name">Rain</span>
               </div>
            </div>
         </div>
      </div>
      
      <div class="container">
         <div class="header">
            <h1>Curtain</h1>
            <br>
            <h2>Complete your daily habits</h2>
            <p>Build better habits, one day at a time</p>
            <div class="daily-quote" id="daily-quote">
               <span class="quote-text" id="quote-text"></span>
               <span class="quote-author" id="quote-author"></span>
            </div>
         </div>
         <div class="add-habit">
            <input type="text" id="habit-input" placeholder="Add a new habit" maxlength="100">
            <button class="add-btn" onclick="addHabit()">Add Habit</button>
         </div>
         <div class="progress-section">
            <div class="progress-bar">
               <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="progress-text" id="progress-text">0 of 0 habits completed</div>
         </div>
         <div class="habits-list" id="habits-list">
            <div class="empty-state">
               <h3>No habits yet</h3>
               <p>Add your first habit above to get started!</p>
            </div>
         </div>
         <div class="bottom-actions" id="bottom-actions">
            <button class="secondary-reset-btn" onclick="resetCompleted()">Reset</button>
            <button class="secondary-delete-btn" onclick="deleteAllHabits()">Delete All</button>
         </div>
         <div class="footer-info">
            All completed habits will automatically reset at midnight.
            <br>
            Start fresh each day to build consistent habits!
         </div>
      </div>
      
      <!-- Delete Modal -->
      <div class="modal-overlay" id="delete-modal">
         <div class="modal">
            <h3>Are you sure you want to delete this habit?</h3>
            <div class="modal-buttons">
               <button class="modal-btn cancel" onclick="hideDeleteModal()">Cancel</button>
               <button class="modal-btn confirm" onclick="confirmDelete()">OK</button>
            </div>
         </div>
      </div>
      
      <!-- Alert Modal -->
      <div class="modal-overlay" id="alert-modal">
         <div class="modal">
            <h3 id="alert-message"></h3>
            <div class="modal-buttons">
               <button class="modal-btn ok" onclick="hideAlertModal()">OK</button>
            </div>
         </div>
      </div>
      
      <!-- Confirm Modal -->
      <div class="modal-overlay" id="confirm-modal">
         <div class="modal">
            <h3 id="confirm-message"></h3>
            <div class="modal-buttons">
               <button class="modal-btn cancel" onclick="hideConfirmModal(false)">Cancel</button>
               <button class="modal-btn confirm" onclick="hideConfirmModal(true)">OK</button>
            </div>
         </div>
      </div>
      
      <script>
         // Global variables
         let habits = [];
         let habitToDelete = null;
         let confirmCallback = null;
         let streakData = { count: 0, lastCompletedDate: null };
         let themeEngine = null;
         const themes = ['starry-night', 'cloudy-day', 'ocean', 'forest', 'cherry-blossom', 'snow', 'rain'];
         
         const dailyQuotes = [
           { text: "Success is the sum of small efforts repeated day in and day out.", author: "Robert Collier" },
           { text: "We are what we repeatedly do. Excellence, then, is not an act, but a habit.", author: "Aristotle" },
           { text: "The secret of getting ahead is getting started.", author: "Mark Twain" },
           { text: "A journey of a thousand miles begins with a single step.", author: "Lao Tzu" },
           { text: "You don't have to be great to get started, but you have to get started to be great.", author: "Les Brown" },
           { text: "Small daily improvements over time lead to stunning results.", author: "Robin Sharma" },
           { text: "The best time to plant a tree was 20 years ago. The second best time is now.", author: "Chinese Proverb" },
           { text: "Progress, not perfection.", author: "Anonymous" },
           { text: "Every master was once a beginner. Every pro was once an amateur.", author: "Robin Sharma" },
           { text: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
           { text: "The only impossible journey is the one you never begin.", author: "Tony Robbins" },
           { text: "Your future is created by what you do today, not tomorrow.", author: "Robert Kiyosaki" }
         ];
         
         async function init() {
           // Initialize theme engine
           themeEngine = new ThemeEngine();
           await themeEngine.init(THEME_REGISTRY);
           
           displayCurrentDate();
           displayDailyQuote();
           loadHabits();
           loadStreakData();
           renderHabits();
           updateProgress();
           updateStreakDisplay();
           setupEventListeners();
         }
         
         function displayDailyQuote() {
           const today = new Date();
           const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
           const quoteIndex = dayOfYear % dailyQuotes.length;
           const quote = dailyQuotes[quoteIndex];
           
           document.getElementById('quote-text').textContent = `"${quote.text}"`;
           document.getElementById('quote-author').textContent = `â€” ${quote.author}`;
         }
         
         function displayCurrentDate() {
           const today = new Date();
           const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
           const mobileOptions = { weekday: 'short', month: 'short', day: 'numeric' };
           
           // Desktop date
           const desktopDate = document.getElementById('current-date');
           if (desktopDate) {
             desktopDate.textContent = today.toLocaleDateString('en-US', options);
           }
           
           // Mobile date (shorter format)
           const mobileDate = document.getElementById('current-date-mobile');
           if (mobileDate) {
             mobileDate.textContent = today.toLocaleDateString('en-US', mobileOptions);
           }
         }
         
         function loadHabits() {
           const today = new Date().toDateString();
           const savedData = localStorage.getItem('habitTracker');
           if (savedData) {
             const data = JSON.parse(savedData);
             if (data.date !== today) {
               habits = data.habits.map(habit => ({ ...habit, completed: false }));
               saveHabits();
             } else {
               habits = data.habits || [];
             }
           }
         }
         
         function saveHabits() {
           const today = new Date().toDateString();
           localStorage.setItem('habitTracker', JSON.stringify({ date: today, habits }));
         }
         
         function loadStreakData() {
           const saved = localStorage.getItem('habitStreak');
           if (saved) {
             streakData = JSON.parse(saved);
           }
         }
         
         function saveStreakData() {
           localStorage.setItem('habitStreak', JSON.stringify(streakData));
         }
         
         function updateStreakDisplay() {
           const streakText = streakData.count === 0 ? 'ðŸŒ± Start your streak!' : `ðŸ”¥ ${streakData.count}-day streak`;
           
           // Desktop streak counter
           const desktopStreak = document.getElementById('streak-counter');
           if (desktopStreak) {
             desktopStreak.textContent = streakText;
           }
           
           // Mobile streak counter
           const mobileStreak = document.getElementById('streak-counter-mobile');
           if (mobileStreak) {
             mobileStreak.textContent = streakText;
           }
         }
         
         function checkStreakUpdate() {
           const today = new Date().toDateString();
           const total = habits.length;
           const completed = habits.filter(h => h.completed).length;
           
           if (total > 0 && completed === total) {
             // All habits completed
             if (streakData.lastCompletedDate !== today) {
               const yesterday = new Date();
               yesterday.setDate(yesterday.getDate() - 1);
               const yesterdayStr = yesterday.toDateString();
               
               if (streakData.lastCompletedDate === yesterdayStr) {
                 // Consecutive day
                 streakData.count++;
               } else {
                 // New streak or broken streak
                 streakData.count = 1;
               }
               streakData.lastCompletedDate = today;
               saveStreakData();
               updateStreakDisplay();
               
               // Show completion animation
               showCompletionAnimation();
             }
           } else if (total > 0) {
             // Not all habits completed - check if streak should be broken
             const yesterday = new Date();
             yesterday.setDate(yesterday.getDate() - 1);
             const yesterdayStr = yesterday.toDateString();
             
             if (streakData.lastCompletedDate === yesterdayStr && streakData.count > 0) {
               // Streak is still valid for today
               return;
             }
           }
         }
         
         function showCompletionAnimation() {
           const overlay = document.getElementById('completion-overlay');
           const confetti = document.getElementById('confetti');
           const completionContent = overlay.querySelector('.completion-content');
           
           // Get theme-specific completion config
           const completionConfig = themeEngine.getCompletionConfig();
           if (completionConfig) {
             const icon = completionContent.querySelector('.completion-icon');
             const title = completionContent.querySelector('h2');
             const message = completionContent.querySelector('p');
             
             icon.textContent = completionConfig.icon;
             title.textContent = completionConfig.title;
             message.textContent = completionConfig.message;
           }
           
           // Generate theme-specific confetti
           confetti.innerHTML = '';
           themeEngine.generateThemeConfetti(confetti);
           
           // Show overlay
           overlay.classList.add('show');
           
           // Auto-hide after 4 seconds
           setTimeout(() => {
             overlay.classList.remove('show');
           }, 4000);
         }
         
         function addHabit() {
           const input = document.getElementById('habit-input');
           const habitText = input.value.trim();
           if (!habitText) return showAlert('Please enter a habit!');
           if (habits.some(h => h.text.toLowerCase() === habitText.toLowerCase())) return showAlert('This habit already exists!');
           habits.push({ id: Date.now(), text: habitText, completed: false });
           input.value = '';
           saveHabits(); 
           renderHabits(); 
           updateProgress();
         }
         
         function toggleHabit(id) {
           habits = habits.map(h => h.id === id ? { ...h, completed: !h.completed } : h);
           saveHabits(); 
           renderHabits(); 
           updateProgress();
         }
         
         function deleteHabit(id) { 
           habitToDelete = id; 
           showDeleteModal(); 
         }
         
         function showDeleteModal() { 
           document.getElementById('delete-modal').classList.add('show'); 
         }
         
         function hideDeleteModal() { 
           document.getElementById('delete-modal').classList.remove('show'); 
           habitToDelete = null; 
         }
         
         // Custom Alert Modal
         function showAlert(message) {
           document.getElementById('alert-message').textContent = message;
           document.getElementById('alert-modal').classList.add('show');
         }
         
         function hideAlertModal() { 
           document.getElementById('alert-modal').classList.remove('show'); 
         }
         
         // Custom Confirm Modal
         function showConfirm(message, callback) {
           document.getElementById('confirm-message').textContent = message;
           confirmCallback = callback;
           document.getElementById('confirm-modal').classList.add('show');
         }
         
         function hideConfirmModal(result) {
           document.getElementById('confirm-modal').classList.remove('show');
           if (confirmCallback) {
             confirmCallback(result);
             confirmCallback = null;
           }
         }
         
         function confirmDelete() {
           if (habitToDelete !== null) {
             habits = habits.filter(h => h.id !== habitToDelete);
             saveHabits(); 
             renderHabits(); 
             updateProgress();
           }
           hideDeleteModal();
         }
         
         function renderHabits() {
           const list = document.getElementById('habits-list');
           const footer = document.querySelector('.footer-info');
           const progressSection = document.querySelector('.progress-section');
           const bottomActions = document.getElementById('bottom-actions');
           
           if (habits.length === 0) {
             list.innerHTML = `<div class="empty-state"><span class="emoji">ðŸŒ±</span><h3>Ready to build great habits?</h3><p>Add your first habit above to get started on your journey!</p></div>`;
             footer.style.display = 'none';
             progressSection.style.display = 'none';
             bottomActions.style.display = 'none';
             return;
           }
           
           footer.style.display = 'block';
           progressSection.style.display = 'block';
           bottomActions.style.display = 'flex';
           list.innerHTML = habits.map(habit => `
             <div class="habit-item ${habit.completed ? 'completed' : ''}">
               <div class="habit-checkbox ${habit.completed ? 'checked' : ''}" onclick="toggleHabit(${habit.id})"></div>
               <span class="habit-text">${habit.text}</span>
               <div class="delete-btn-container">
                 <button class="delete-btn" onclick="deleteHabit(${habit.id})"></button>
               </div>
             </div>
           `).join('');
         }
         
         function updateProgress() {
           const total = habits.length;
           const done = habits.filter(h => h.completed).length;
           const percent = total > 0 ? (done / total) * 100 : 0;
           document.getElementById('progress-fill').style.width = `${percent}%`;
           document.getElementById('progress-text').textContent = `${done} of ${total} habits completed`;
           checkStreakUpdate();
         }
         
         function resetCompleted() {
           habits = habits.map(h => ({ ...h, completed: false }));
           saveHabits(); 
           renderHabits(); 
           updateProgress();
         }
         
         function deleteAllHabits() {
           if (habits.length === 0) return;
           showConfirm('Are you sure you want to delete all habits? This action cannot be undone.', (confirmed) => {
             if (confirmed) {
               habits = [];
               saveHabits(); 
               renderHabits(); 
               updateProgress();
             }
           });
         }
         
         // Theme Management - now uses theme engine
         function selectTheme(theme) {
           if (themeEngine && themes.includes(theme)) {
             themeEngine.switchTheme(theme);
           }
         }
         
         function toggleThemeDropdown() {
           // Check if we're on mobile or desktop based on screen width
           const isMobile = window.innerWidth <= 768;
           
           if (isMobile) {
             const mobileDropdown = document.getElementById('theme-dropdown-mobile');
             if (mobileDropdown) {
               mobileDropdown.classList.toggle('open');
             }
           } else {
             const desktopDropdown = document.getElementById('theme-dropdown');
             if (desktopDropdown) {
               desktopDropdown.classList.toggle('open');
             }
           }
         }
         
         function setupEventListeners() {
           // Input event listener
           document.getElementById('habit-input').addEventListener('keypress', e => { 
             if (e.key === 'Enter') addHabit(); 
           });
           
           // Modal event listeners
           document.getElementById('delete-modal').addEventListener('click', e => { 
             if (e.target === e.currentTarget) hideDeleteModal(); 
           });
           
           document.getElementById('alert-modal').addEventListener('click', e => { 
             if (e.target === e.currentTarget) hideAlertModal(); 
           });
           
           document.getElementById('confirm-modal').addEventListener('click', e => { 
             if (e.target === e.currentTarget) hideConfirmModal(false); 
           });
           
           document.getElementById('completion-overlay').addEventListener('click', e => { 
             if (e.target === e.currentTarget) document.getElementById('completion-overlay').classList.remove('show'); 
           });
           
           // Theme dropdown event listeners
           const themeOptions = document.querySelectorAll('.theme-dropdown-option');
           themeOptions.forEach(option => {
             option.addEventListener('click', () => {
               const theme = option.dataset.theme;
               selectTheme(theme);
               // Close both desktop and mobile dropdowns
               const desktopDropdown = document.getElementById('theme-dropdown');
               const mobileDropdown = document.getElementById('theme-dropdown-mobile');
               if (desktopDropdown) desktopDropdown.classList.remove('open');
               if (mobileDropdown) mobileDropdown.classList.remove('open');
             });
           });
           
           // Close dropdown when clicking outside
           document.addEventListener('click', (e) => {
             const desktopDropdown = document.getElementById('theme-dropdown');
             const mobileDropdown = document.getElementById('theme-dropdown-mobile');
             
             if (desktopDropdown && !desktopDropdown.contains(e.target)) {
               desktopDropdown.classList.remove('open');
             }
             if (mobileDropdown && !mobileDropdown.contains(e.target)) {
               mobileDropdown.classList.remove('open');
             }
           });
         }
         
         // Initialize the application
         document.addEventListener('DOMContentLoaded', init);
      </script>
   </body>
</html>
